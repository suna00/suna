[
  {
    "typeId": "apiCategory",
    "id": "serviceCenter",
    "categoryName": "서비스센터 API",
    "fileUrlFormat" : {
       "default": "/"
    }
  },
  {
    "typeId": "apiConfig",
    "category": "serviceCenter",
    "apiId": "recommendedFaqList",
    "apiName": "추천 FAQ",
    "method": "GET",
    "parameters": [],
    "config": {
      "typeId": "frequentlyAskedQuestion",
      "query": [
        {
          "field": "topStatus",
          "method": "matching",
          "value": "active"
        },
        {
          "field": "faqType1",
          "method": "matching",
          "value": "{{:faqType}}"
        },
        {
          "count": 5
        }
      ],
      "response": {
        "_all_": ""
      }
    }
  },
  {
    "typeId": "apiConfig",
    "category": "serviceCenter",
    "apiId": "orderList",
    "apiName": "사용자 주문/배송조회 리스트",
    "method": "GET",
    "parameters": [],
    "config": {
      "typeId": "orderSheet",
      "query": [
        {
          "field": "memberNo",
          "method": "equals",
          "value": "{{:session.member.memberNo}}"
        },
        {
          "field": "created",
          "method": "above",
          "value": "{{:startDate}}"
        },
        {
          "field": "created",
          "method": "below",
          "value": "{{:endDate}}"
        },
        {
          "field": "orderSheetId",
          "method": "matchingShould",
          "value": "{{:searchText}}"
        },
        {
          "field": "productId",
          "method": "matchingShould",
          "value": "{{:searchText}}"
        },
        {
          "includeReferenced": true,
          "sorting": "created desc"
        },
        {
          "pageSize": "{{:pageSize}}",
          "page": "{{:page}}"
        },
        {
          "field": "referencedOrderProduct",
          "method": "hasReferenced",
          "value": "orderStatus_equals={{:orderStatus}}"
        }
      ],
      "response": {
        "_all_": "",
        "referencedOrderProduct" : {
          "typeId" : "orderProduct",
          "query" : [
            {"field" : "orderSheetId", "method" : "equals", "value" : "{{:orderSheetId}}"},
            {"field" : "productId", "method" : "equals", "value" : "{{:productId}}"},
            {"includeReferenced" : "referencedMainImage", "referenceView": "productId,deliveryEnterpriseId"}
          ],
          "response": {
            "_all_": "",
            "productId": {"field" : "productId",  "referenceView":"productId,deliveryEnterpriseId", "includeReferenced" : "referencedMainImage"},
            "referencedOrderDeliveryPrice" : {
              "select": {
                "ds": "ytnDevDb",
                "resultType": "read",
                "description": "주문배송비 정보",
                "sql": "select a.orderDeliveryPriceId ,a.orderSheetId ,a.orderProductIds ,a.vendorId ,a.deliveryPrice ,a.bundleDeliveryYn ,a.deliveryMethod ,a.deliveryPriceType ,a.couponId ,a.deliveryEnterpriseId ,a.sendingDate ,a.trackingNo ,a.deliveryStatus ,a.deliveryDateType ,a.scheduledDeliveryDate ,a.hopeDeliveryDate ,a.changed ,a.created ,b.name ,b.deliverySearchUrl ,b.deliveryEnterpriseStatus from orderdeliveryprice a LEFT JOIN deliveryenterprise b on a.deliveryEnterpriseId = b.deliveryEnterpriseId where a.orderSheetId= @{orderSheetId} and find_in_set( @{orderProductId},a.orderProductIds) > 0 "
              }
            },
            "functionBtn": {
              "select": {
                "ds": "ytnDevDb",
                "resultType": "read",
                "description": "버튼 조회 정보",
                "sql": "SELECT if(a.orderstatus = 'order002' || a.orderstatus = 'order003' || a.orderStatus = 'order004', 'true', 'false') AS cancelBtn, if(b.contentsType = 'goods' && (a.orderstatus = 'order005' || a.orderstatus = 'order006'), 'true', 'false') AS exchangeBtn, if(b.contentsType = 'goods' && (a.orderstatus = 'order005' || a.orderstatus = 'order006'), 'true', 'false') AS returnBtn, (CASE WHEN b.contentsType = 'goods' THEN if((SELECT IFNULL(max(if((sendingDate + INTERVAL 30 DAY) >= now(), TRUE, FALSE)), FALSE)FROM orderdeliveryprice WHERE orderSheetId = a.orderSheetId and find_in_set(@{orderProductId}, orderProductIds) > 0) && (a.orderstatus = 'order005' || a.orderstatus = 'order006' || a.orderstatus = 'order007'), 'true', 'false') ELSE if(a.orderstatus = 'order005' || a.orderstatus = 'order006' || a.orderstatus = 'order007', 'true', 'false') END ) AS reviewBtn, if(b.contentsType = 'goods' && b.deliveryMethod = 'delivery' && (a.orderstatus = 'order005' || a.orderstatus = 'order006' || a.orderstatus = 'order015' || a.orderstatus = 'order016'), 'true', 'false') AS trackingViewBtn, if(b.contentsType = 'goods' && (a.orderstatus = 'order002' || a.orderstatus = 'order003'), 'true','false') AS addressChangeBtn FROM orderproduct a, product b WHERE a.productId = b.productId AND a.orderProductId = @{orderProductId} "
              }
            }
          }
        }
      }
    }
  }
]