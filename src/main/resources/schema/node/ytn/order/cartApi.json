[
  {
    "typeId" : "apiCategory",
    "id" : "cart",
    "categoryName" : "장바구니 API"
  },
  {
    "typeId" : "apiConfig",
    "category" : "cart",
    "apiId" : "read",
    "apiName" : "장바구니 조회",
    "method" : "GET",
    "parameters" : [
    ],
    "config" : {
      "item" : {
        "select" : {
          "ds" : "ytnDevDb",
          "resultType" : "read",
          "sql" : "select cart.* , (totalProductPrice + totalDeliveryPrice - totalDiscountPrice) as totalOrderPrice from ( select a.cartId, a.memberNo, a.siteId, a.sessionId, (select ifnull(sum(orderPrice),0) from cartProduct where cartId = a.cartId) as totalProductPrice , (select ifnull(sum(deliveryPrice),0) from cartdeliveryprice where cartId = a.cartId) as totalDeliveryPrice , 0 as totalDiscountPrice from cart a where cartId = {{:cartId}} or sessionId = '{{:sessionId}}') cart"
        }
      },
      "referencedCartProduct" : {
        "typeId" : "cartProduct",
        "query" : [
          {"sorting" : "cartDeliveryPriceId desc,created desc"},
          {"field" : "cartId", "method" : "matching", "value" : "{{:cartId}}"},
          {"includeReferenced" : true, "referenceView": "productId"}
        ]
      }
    }
  },
  {
    "typeId" : "apiConfig",
    "category" : "cart",
    "apiId" : "addCart",
    "apiName" : "장바구니 담기",
    "method" : "GET",
    "parameters" : [
    ],
    "config" : {
      "item" : {
        "select" : {
          "ds" : "ytnDevDb",
          "resultType" : "read",
          "sql" : "select max(cartId) as searchCartId from cart where memberNo = @{memberNo} or sessionId = @{sessionId}"
        }
      },
      "successADD" : {
        "typeId": "cart",
        "event": "create",
        "if" : "{{:equals(searchCartId, null)}}",
        "data": {
          "memberNo": "{{:memberNo}}",
          "siteId": "{{:siteId}}",
          "sessionId": "{{:sessionId}}",
          "buyNowYn": "{{:buyNowYn}}"
        }
      }
    }
  }
]