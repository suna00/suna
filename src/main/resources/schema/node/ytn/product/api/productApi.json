[
  {
    "typeId" : "apiCategory",
    "id" : "adminProduct",
    "categoryName" : "관리자 상품 API"
  },
  {
    "typeId" : "apiConfig",
    "category" : "adminProduct",
    "apiId" : "read",
    "apiName" : "상품 read",
    "method" : "GET",
    "parameters" : [
    ],
    "config" : {
      "typeId": "product",
      "id": "{{:productId}}",
      "includeReferenced" : "true",
      "response": {
        "_all_": "",
        "referencedProductToCategoryMap" : {
          "typeId": "productToCategoryMap",
          "query" : [
            {"field" : "productId", "method" : "matching", "value" : "{{:productId}}" },
            {"referenceView": "categoryId"}
          ]
        }
      }
    }
  },
  {
    "typeId" : "apiCategory",
    "id" : "product",
    "categoryName" : "상품 API",
    "fileUrlFormat" : {
       "default": "{{:getEnvValue(cluster.file-prefix, url)}}"
    }
  },
  {
    "typeId" : "apiConfig",
    "category" : "product",
    "apiId" : "list",
    "apiName" : "상품 리스트",
    "method" : "GET",
    "parameters" : [
    ],
    "config" : {
      "typeId": "product",
      "query" : [
        {"field" : "salePrice", "method" : "fromto", "value" : "{{:salePrice}}" },
        {"sorting" : "{{:sorting}}", "pageSize": "{{:pageSize}}", "page": "{{:page}}"},
        {"field" : "name", "method" : "matchingShould", "value" : "{{:wildcard(searchValue)}}" },
        {"field" : "modelName", "method" : "matchingShould", "value" : "{{:wildcard(searchValue)}}" },
        {"field" : "referencedProductSearchFilter", "method" : "hasReferenced", "value" : "searchFilterCodeIds_matching={{:searchFilterCodeIds}}"},
        {"field" : "referencedProductToCategoryMap", "method" : "hasReferenced", "value" : "categoryId_matching={{:categoryId}}"},
        {"includeReferenced" : "referencedMainImage,referencedProductSearchFilter"}
      ],
      "response": {
        "_all_": "",
        "downloadableCoupon": {
          "select" : {
            "ds" : "ytnDevDb",
            "resultType" : "read",
            "sql" : "select count(*) as couponCount from ( SELECT couponTypeId FROM couponTypeToCategoryMap c, producttocategorymap p WHERE productId = @{productId} AND p.categoryId = c.categoryId GROUP BY couponTypeId union ALL select couponTypeId from couponTypeToProductMap WHERE productId = @{productId} ) a, coupontype b WHERE b.couponTypeId = a.couponTypeId AND b.couponType in ('product','category') AND b.siteType != IF(IFNULL(@{session.member.siteType}, 'company') = 'university', 'company', 'university') AND createPeriodType != 'stop' AND createStartDate <= now() AND createEndDate >= now()  "
          }
        }
      }
    }
  },
  {
    "typeId" : "apiConfig",
    "category" : "product",
    "apiId" : "view",
    "apiName" : "상품 view",
    "method" : "GET",
    "parameters" : [
    ],
    "config" : {
      "updateViewCount" : {
        "typeId": "product",
        "noneExecute": true,
        "resultType" : "none",
        "event" : "view",
        "data": {
          "productId": "{{:productId}}"
        }
      },
      "root": {
        "typeId": "product",
        "id": "{{:productId}}",
        "includeReferenced": "true",
        "response": {
          "_all_": ""
        }
      }
    }
  },
  {
    "typeId" : "apiConfig",
    "category" : "product",
    "apiId" : "searchFilterList",
    "apiName" : "카테고리별 상세 검색코드 리스트",
    "method" : "GET",
    "parameters" : [
    ],
    "config" : {
      "typeId": "category",
      "query" : [
        {"field" : "categoryId", "method" : "matching", "value" : "{{:categoryId}}" }
      ],
      "response": {
        "categoryId": "",
        "name": "",
        "searchFilterIds": "",
        "searchFilter": {
          "typeId": "searchFilter",
          "query" : [
            {"field" : "searchFilter", "method" : "matching", "value" : "{{:searchFilterIds}}" },
            { "includeReferenced": true }
          ]
        }
      }
    }
  },
  {
    "typeId": "apiConfig",
    "category": "product",
    "apiId": "recentlyViewed",
    "apiName": "최근 본 상품",
    "method": "GET",
    "parameters": [
    ],
    "config" : {
      "typeId": "product",
      "query" : [
        {"field" : "productId", "method" : "matching", "value" : "{{:productIds}}" }
      ]
    }
  },
  {
    "typeId": "apiConfig",
    "category": "product",
    "apiId": "reviewInterestCnt",
    "apiName": "구매평 위시리스트 카운트 조회",
    "method": "GET",
    "parameters": [
    ],
    "config": {
      "item": {
        "select": {
          "ds": "ytnDevDb",
          "resultType": "read",
          "description": "구매평 위시리스트 카운트 조회",
          "sql": "select (select count(*) as wishCount from interestproduct where productId=@{productId}) as wishCount,(select round(sum(score)/count(reviewId)) as reviewAverageScore from review where productId=@{productId} and siteId=@{siteId}) as reviewAverageScore;"
        }
      }
    }
  },
  {
    "typeId": "apiConfig",
    "category": "product",
    "apiId": "addWishList",
    "apiName": "위시리스트 삭제",
    "method": "POST",
    "parameters": [
    ],
    "config": {
      "typeId": "interestProduct",
      "noneExecute": true,
      "event" : "addWishList",
      "data": {
      }
    }
  }
]